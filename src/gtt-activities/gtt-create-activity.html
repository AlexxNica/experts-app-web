<!--
    Google Developers Experts Tracking App
    Copyright (C) 2016  by the GDE Tracking App Team

    gdetracking.appspot.com/
    https://github.com/GoogleDeveloperExperts/experts-app-web

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>
-->
<link rel="import" href="../../bower_components/polymer/polymer.html">



<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">

<link rel="import" href="../../bower_components/paper-button/paper-button.html"
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-dialog-behavior/paper-dialog-behavior.html">

<!--
    ====================================
                  Shady DOM
    ====================================
-->

<dom-module 
  id = "gtt-create-activity">
  <template>
    
<!--
    ====================================
                     CSS 
    ====================================
-->
    <style>
      :host {
        display           : block;
        position          : fixed;
        top               : 20vh;
        left              : 11vw;
        width             : 70vw;
        overflow          : auto;
        border-radius     : 2px;    
        background: white;
        transition        : box-shadow 0.5s cubic-bezier(.25,.8,.25,1);
        box-shadow        : 0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22);
      }
     :host:hover {
        box-shadow        : 0 19px 38px rgba(0,0,0,0.30), 0 15px 12px rgba(0,0,0,0.22);
      }
      :host > * {
        padding           : 0 !important;
      }
      :host  #closeCreateActivity {
        position          : absolute;
        justify-content   : flex-end;
        right             : 16px;
        top               : 16px;
        margin            : 0;
        transition        : color 0.5s cubic-bezier(.25,.8,.25,1);
        color             : #e5e5e5;
      }
      :host #closeCreateActivity:hover {
        color             : #aaa;
      }
      :host  #continue {
        margin            : 0 auto;
      }
      :host  h2 {
        display           : flex;
        align-items       : center;
        color             : #4285f4;
        font-size         : 16px;
        font-weight       : 500;
        min-height        : 56px;
      }
      :host  > h2 {
        margin            : 0 0 0 21px !important;
      }
      :host  h2  iron-icon {
        margin-right      : 10px;
        color             : #e5e5e5;
        cursor            : pointer;
        transition        : color 0.5s cubic-bezier(.25,.8,.25,1);
      }
      :host  h2  iron-icon:hover {
        color             : #aaa;
      }
      :host  section {
        flex              : 1;
        margin            : 0 56px !important;
      }
      :host  section  article {
        display           : flex;
        justify-content   : center;
        flex-wrap         : wrap;
      }
      :host  section#details {
        display           : flex;
        flex-wrap         : wrap;
      }
      :host  section#details  paper-input {
        width             : 100%;
      }
      :host  section  article  paper-button {
        margin            : 5px;
        font-weight       : normal !important;
        cursor            : pointer;
      }
      :host  section  article  paper-button[active] {
        background-color  : #34a853;
        color             : #fff;
        margin            : 5px;
      }
      :host  footer {
        display           : flex;
        flex-direction    : column;
        align-items       : center;
        justify-content   : center;
        height            : 100px;
      }
      :host  footer  paper-button {
        color             : #fff;
        background-color  : #4285f4;
        border-radius     : 2px;
        padding           : 14px 30px;
        font-size         : 14px;
      }
      :host  footer  .progress {
        display           : flex;
        flex-direction    : row;
        justify-content   : center;
        align-items       : center;
        height            : 48px;
      }
      :host  footer  .progress  .indicator {
        border-radius     : 50%;
        width             : 8px;
        height            : 8px;
        margin            : 0 3px 0;
        background-color  : #d8d8d8;
      }
      :host  footer  .progress  .indicator#first[active] {
        background-color  : #4285f4;
      }
      :host  footer  .progress  .indicator#second[active] {
        background-color  : #ea4335;
      }
      :host  footer  .progress  .indicator#third[active] {
        background-color  : #fbbc05;
      }
      :host  footer  .progress  .indicator#fourth[active] {
        background-color  : #34a853;
      }      
      
    </style>
<!--  
    ====================================
                   HTML
    ====================================
-->

      
      <paper-button
        id = "closeCreateActivity"
        dialog-confirm
        autofocus>
        <iron-icon 
          icon = "close">
        </iron-icon>
      </paper-button>

      <iron-pages id="ironpages" selected="{{_currentStep}}">
        
        <!-- Tab 0 -->
        <div>
          <h2>
            <iron-icon 
              icon = "add-circle">
            </iron-icon>
            Add an activity
          </h2>
          <section>
            <p>Fill in the details below to add and track your activity.</p>
            <paper-input
              id    = "title"
              type  = "text"
              label = "Activity Title"
              value = "{{ newActivity.title }}">
            </paper-input>
            <paper-input
              id    = "description"
              type  = "text"
              label = "Description"
              value = "{{ newActivity.description }}">
            </paper-input>
          </section>
          <footer>
            <paper-button 
              id     = "continue" 
              on-tap = "next">
              Continue
            </paper-button>
            <div
              class = "progress">
              <div 
                class = "indicator"
                id    = "first"
                active>
              </div>
              <div
                class = "indicator"
                id    = "second">
              </div>
              <div
                class = "indicator"
                id    = "third">
              </div>
              <div
                class = "indicator"
                id    = "fourth">
              </div>
            </div>
          </footer>
        </div>  
        
        <!-- Tab 1 -->
        <div>
          <h2>
            <iron-icon 
              icon   = "arrow-back"
              on-tap = "back">
            </iron-icon>
            Activity Types
          </h2>
          <section>
            <article
              id     = "types">
              <template 
                is    = "dom-repeat" 
                items = "[[activityTypes]]">
                <paper-button
                    on-tap = "selectActivityType"
                    class  = "activityType"
                    id     = "{{item.id}}"
                    toggles
                    raised>
                  {{item.tag}}
                </paper-button>

              </template>
            </article>
          </section>
          <footer>
            <paper-button 
              id     = "continue" 
              on-tap = "next">
              Continue
            </paper-button>
            <div
              class = "progress">
              <div 
                class = "indicator"
                id    = "first">
              </div>
              <div
                class = "indicator"
                id    = "second"
                active>
              </div>
              <div
                class = "indicator"
                id    = "third">
              </div>
              <div
                class = "indicator"
                id    = "fourth">
              </div>
            </div>
          </footer>
        </div>
        
        <!-- Tab 2 -->
        <div>
          <h2>
            <iron-icon 
              icon   = "arrow-back" 
              on-tap = "back">
            </iron-icon>
            Details
          </h2>
          <section
            id  = "details">
            <paper-input
              id    = "city"
              type  = "text"
              label = "Which city?"
              value = "{{ newActivity.city }}">
            </paper-input>
            <paper-input
              id    = "country"
              type  = "text"
              label = "Which country?"
              value = "{{ newActivity.country }}">
            </paper-input>
            <paper-input
              id    = "date"
              type  = "date"
              label = "When it happened?"
              value = "{{ newActivity.date }}">
            </paper-input>
          </section>
          <footer>
            <paper-button 
              id     = "continue" 
              on-tap = "next">
              Continue
            </paper-button>
            <div
              class = "progress">
              <div 
                class = "indicator"
                id    = "first">
              </div>
              <div
                class = "indicator"
                id    = "second">
              </div>
              <div
                class = "indicator"
                id    = "third"
                active>
              </div>
              <div
                class = "indicator"
                id    = "fourth">
              </div>
            </div>
          </footer>
        </div>
        
        <!-- Tab 3 -->
        <div>
          <h2>
            <iron-icon 
              icon   = "arrow-back" 
              on-tap = "back">
            </iron-icon>
            Details
          </h2>
          <section
            id  = "details">
            <paper-input
              id    = "url"
              type  = "text"
              label = "A link for this?"
              value = "{{ newActivity.url }}">
            </paper-input>
            <paper-input
              id    = "metric_reached"
              type  = "number"
              label = "How many people?"
              value = "{{ newActivity.metric_reached }}">
            </paper-input>
          </section>
          <footer>
            <paper-button 
              id     = "continue" 
              on-tap = "finish">
              Finish
            </paper-button>
            <div
              class = "progress">
              <div 
                class = "indicator"
                id    = "first">
              </div>
              <div
                class = "indicator"
                id    = "second">
              </div>
              <div
                class = "indicator"
                id    = "third">
              </div>
              <div
                class = "indicator"
                id    = "fourth"
                active>
              </div>
            </div>
          </footer>          
        </div>        
      </iron-pages>  



      



  </template>
<!--
    ====================================
                    JS
    ====================================
-->
  <script>
    Polymer({ 
      is: 'gtt-create-activity',
      properties: {
        
        /**
         * The new activity
         */
        newActivity     : {
          type             : 'Object',
          notify           : true,
          value            : function() {
            return {
              'title'       : '',
              'description' : ''
            };
          }
        },
        
        
        /**
         * The allowed activity types 
         */     
        
        activityTypes   : {
          type             : 'array',
          notify           : true,
          value            : [
            {
               'id'  : '',
               'tag' : '#'
            } 
          ],
        },
        
        
        _currentStep : {
          type: Number,
          value: 0
        },
        _numberOfSteps: {
          type: Number,
          value: 4
        },
      },
      behaviors: [
        Polymer.PaperDialogBehavior
      ],

      back: function() {
        if (this._currentStep > 0) {
          this._currentStep -= 1;
        }
      },      
      next: function() {
        console.debug("[gtt-create-activity] next - current tab: ", this._currentStep );
        if (this._currentStep < this._numberOfSteps -1) {
          this._currentStep += 1;
        }
      },      
      
      finish: function(){
        
        this.$.ironpages.selected = 0;
        console.log("[gtt-create-activity] finish - Activity: ",this.newActivity);
        this.close();
      },
      selectActivityType : function(e){
         var 
         activityTypeSelectors = e.path[1].children,
         selectedActivityType  = e.path[0].id;
         this.newActivity.type = selectedActivityType;
         for (var i=0,total=activityTypeSelectors.length; i<total; i++) {
            if (activityTypeSelectors[i].id != selectedActivityType)
               activityTypeSelectors[i].active = false;
         }
      },
    });
  </script>
</dom-module>
  
  
